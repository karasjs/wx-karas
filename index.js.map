{"version":3,"file":"index.js","sources":["src/index.js"],"sourcesContent":["import karas from 'karas';\nimport { version } from '../package.json';\n\nconst { mode, ca, util, inject, animate: { frame } } = karas;\n\nconst RootList = [];\n\nclass Root extends karas.Root {\n  appendTo(dom) {\n    RootList.push(this);\n    this.__dom = dom;\n    this.__isDestroyed = false;\n    this.__initProps();\n    let tagName = this.tagName;\n    let params = Object.assign({}, ca, this.props.contextAttributes);\n    if(tagName === 'canvas') {\n      this.__ctx = dom.getContext('2d');\n      this.__renderMode = mode.CANVAS;\n    }\n    else if(tagName === 'webgl') {\n      // 优先手动指定，再自动判断，最后兜底\n      let gl, webgl2 = this.props.webgl2;\n      if(!util.isNil(webgl2)) {\n        if(webgl2) {\n          gl = dom.getContext('webgl2', params);\n        }\n        if(!gl) {\n          gl = dom.getContext('webgl', params);\n        }\n        this.__ctx = gl;\n      }\n      else {\n        gl = this.__ctx = dom.getContext('webgl2', params)\n          || dom.getContext('webgl', params);\n      }\n      this.__initShader(gl);\n      this.__renderMode = mode.WEBGL;\n    }\n    this.draw(true);\n    if(this.__dom.__root && this.__dom.__root instanceof Root) {\n      this.__dom.__root.destroy();\n    }\n    this.__dom.__root = this;\n    frame.removeRoot(this);\n    frame.addRoot(this);\n  }\n\n  destroy() {\n    super.destroy();\n    let i = RootList.indexOf(this);\n    if(i > -1) {\n      RootList.splice(i, 1);\n    }\n  }\n}\n\n// Root引用指过来\nlet createVd = karas.createVd;\nkaras.createVd = function(tagName, props, children) {\n  if(['canvas', 'svg', 'webgl'].indexOf(tagName) > -1) {\n    return new Root(tagName, props, children);\n  }\n  return createVd(tagName, props, children);\n};\n\nif(typeof requestAnimationFrame === 'undefined') {\n  inject.requestAnimationFrame = function(cb) {\n    if(!cb || !RootList[0]) {\n      return;\n    }\n    return RootList[0].__dom.requestAnimationFrame(cb);\n  };\n\n  inject.cancelAnimationFrame = function(id) {\n    if(!RootList[0]) {\n      return;\n    }\n    return RootList[0].__dom.cancelAnimationFrame(id);\n  };\n}\n\nconst IMG = inject.IMG;\nconst INIT = inject.INIT;\nconst LOADING = inject.LOADING;\nconst LOADED = inject.LOADED;\nconst FONT = inject.FONT;\n\ninject.measureImg = function(url, cb) {\n  if(!RootList.length && !wx.createImage) {\n    return;\n  }\n  if(Array.isArray(url)) {\n    if(!url.length) {\n      return cb && cb();\n    }\n    let count = 0;\n    let len = url.length;\n    let list = [];\n    url.forEach((item, i) => {\n      inject.measureImg(item, function(cache) {\n        list[i] = cache;\n        if(++count === len) {\n          cb && cb(list);\n        }\n      });\n    });\n    return;\n  }\n  else if(!url || !util.isString(url)) {\n    inject.error('Measure img invalid: ' + url);\n    cb && cb({\n      state: LOADED,\n      success: false,\n      url,\n    });\n    return;\n  }\n  let cache = IMG[url] = IMG[url] || {\n    state: INIT,\n    task: [],\n  };\n  if(cache.state === LOADED) {\n    cb && cb(cache);\n  }\n  else if(cache.state === LOADING) {\n    cb && cache.task.push(cb);\n  }\n  else {\n    cache.state = LOADING;\n    cb && cache.task.push(cb);\n    let img;\n    if(wx.createImage) {\n      img = wx.createImage();\n    }\n    else {\n      img = RootList[0].__dom.createImage();\n    }\n    img.onload = function() {\n      cache.state = LOADED;\n      cache.success = true;\n      cache.width = img.width;\n      cache.height = img.height;\n      cache.source = img;\n      cache.url = url;\n      let list = cache.task.splice(0);\n      list.forEach(cb => cb(cache));\n    };\n    img.onerror = function(e) {\n      cache.state = LOADED;\n      cache.success = false;\n      cache.url = url;\n      let list = cache.task.splice(0);\n      list.forEach(cb => cb(cache));\n    };\n    img.src = url;\n  }\n};\n\ninject.isDom = function(o) {\n  return o && (o.tagName || o.createImage);\n}\n\nconst CANVAS = {};\n\nfunction offscreenCanvas(key, width, height, message, contextAttributes) {\n  let o;\n  if(!key) {\n    o = wx.createOffscreenCanvas ? wx.createOffscreenCanvas({ type: '2d', width, height }) : wx.createCanvas();\n  }\n  else if(!CANVAS[key]) {\n    o = CANVAS[key] = wx.createOffscreenCanvas ? wx.createOffscreenCanvas({ type: '2d', width, height }) : wx.createCanvas();\n  }\n  else {\n    o = CANVAS[key];\n  }\n  if(!wx.createOffscreenCanvas) {\n    o.width = width;\n    o.height = height;\n  }\n  let ctx = o.getContext('2d', contextAttributes);\n  if(!ctx) {\n    inject.error('Total canvas memory use exceeds the maximum limit');\n  }\n  return {\n    canvas: o,\n    ctx,\n    available: true,\n    release() {\n      ctx.globalAlpha = 1;\n      ctx.setTransform(1, 0, 0, 1, 0, 0);\n      ctx.clearRect(0, 0, width, height);\n      this.available = false;\n    },\n  };\n}\n\ninject.hasOffscreenCanvas = function(key) {\n  return key && CANVAS.hasOwnProperty(key);\n};\n\ninject.getOffscreenCanvas = function(width, height, key, message, contextAttributes) {\n  return offscreenCanvas(key, width, height, message, contextAttributes);\n};\n\ninject.loadFont = function(fontFamily, url, cb) {\n  if(!wx.loadFontFace) {\n    return;\n  }\n  if(util.isFunction(url)) {\n    cb = url;\n    url = fontFamily;\n  }\n  if(Array.isArray(url)) {\n    if(!url.length) {\n      return cb();\n    }\n    let count = 0;\n    let len = url.length;\n    let list = [];\n    url.forEach((item, i) => {\n      inject.loadFont(item.fontFamily, item.url, function(cache) {\n        list[i] = cache;\n        if(++count === len) {\n          cb(list);\n        }\n      });\n    });\n    return;\n  }\n  else if(!url || !util.isString(url)) {\n    inject.error('Load font invalid: ' + url);\n    cb && cb({\n      state: LOADED,\n      success: false,\n      url,\n    });\n    return;\n  }\n  if(!fontFamily) {\n    fontFamily = url;\n  }\n  let cache = FONT[url] = FONT[url] || {\n    state: INIT,\n    task: [],\n  };\n  if(cache.state === LOADED) {\n    cb && cb(cache);\n  }\n  else if(cache.state === LOADING) {\n    cb && cache.task.push(cb);\n  }\n  else {\n    cache.state = LOADING;\n    cb && cache.task.push(cb);\n    if(url instanceof ArrayBuffer) {\n      success(url);\n    }\n    else {\n      wx.loadFontFace({\n        family: fontFamily,\n        source: `url(\"${url}\")`,\n        success,\n        fail: error,\n      });\n    }\n    function success() {\n      cache.state = LOADED;\n      cache.success = true;\n      cache.url = url;\n      let list = cache.task.splice(0);\n      list.forEach(cb => cb(cache, ab));\n    }\n    function error() {\n      cache.state = LOADED;\n      cache.success = false;\n      cache.url = url;\n      let list = cache.task.splice(0);\n      list.forEach(cb => cb(cache));\n    }\n  }\n}\n\nkaras.wxVersion = version;\n\nexport default karas;\n"],"names":["mode","karas","ca","util","inject","frame","animate","RootList","Root","_karas$Root","_inherits","apply","arguments","_createClass","key","value","appendTo","dom","push","__dom","__isDestroyed","__initProps","tagName","params","Object","assign","props","contextAttributes","__ctx","getContext","__renderMode","CANVAS","gl","webgl2","isNil","__initShader","WEBGL","draw","__root","destroy","removeRoot","addRoot","_get","_getPrototypeOf","prototype","call","i","indexOf","splice","createVd","children","requestAnimationFrame","cb","cancelAnimationFrame","id","IMG","INIT","LOADING","LOADED","FONT","measureImg","url","length","wx","createImage","Array","isArray","count","len","list","forEach","item","cache","isString","error","state","success","task","img","onload","width","height","source","onerror","e","src","isDom","o","offscreenCanvas","message","createOffscreenCanvas","type","createCanvas","ctx","canvas","available","release","globalAlpha","setTransform","clearRect","hasOffscreenCanvas","hasOwnProperty","getOffscreenCanvas","loadFont","fontFamily","loadFontFace","isFunction","ab","ArrayBuffer","family","concat","fail","wxVersion","version"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;EAGA,IAAQA,IAAI,GAA2CC,yBAAK,CAApDD,IAAI;IAAEE,EAAE,GAAuCD,yBAAK,CAA9CC,EAAE;IAAEC,IAAI,GAAiCF,yBAAK,CAA1CE,IAAI;IAAEC,MAAM,GAAyBH,yBAAK,CAApCG,MAAM;EAAaC,EAAAA,KAAK,GAAOJ,yBAAK,CAA5BK,OAAO,CAAID,KAAK,CAAA;EAEhD,IAAME,QAAQ,GAAG,EAAE,CAAA;EAAC,IAEdC,IAAI,0BAAAC,WAAA,EAAA;IAAAC,SAAA,CAAAF,IAAA,EAAAC,WAAA,CAAA,CAAA;EAAA,EAAA,SAAAD,IAAA,GAAA;EAAA,IAAA,OAAAC,WAAA,CAAAE,KAAA,CAAA,IAAA,EAAAC,SAAA,CAAA,IAAA,IAAA,CAAA;EAAA,GAAA;EAAAC,EAAAA,YAAA,CAAAL,IAAA,EAAA,CAAA;MAAAM,GAAA,EAAA,UAAA;EAAAC,IAAAA,KAAA,EACR,SAAAC,QAASC,CAAAA,GAAG,EAAE;EACZV,MAAAA,QAAQ,CAACW,IAAI,CAAC,IAAI,CAAC,CAAA;QACnB,IAAI,CAACC,KAAK,GAAGF,GAAG,CAAA;QAChB,IAAI,CAACG,aAAa,GAAG,KAAK,CAAA;QAC1B,IAAI,CAACC,WAAW,EAAE,CAAA;EAClB,MAAA,IAAIC,OAAO,GAAG,IAAI,CAACA,OAAO,CAAA;EAC1B,MAAA,IAAIC,MAAM,GAAGC,MAAM,CAACC,MAAM,CAAC,EAAE,EAAEvB,EAAE,EAAE,IAAI,CAACwB,KAAK,CAACC,iBAAiB,CAAC,CAAA;QAChE,IAAGL,OAAO,KAAK,QAAQ,EAAE;UACvB,IAAI,CAACM,KAAK,GAAGX,GAAG,CAACY,UAAU,CAAC,IAAI,CAAC,CAAA;EACjC,QAAA,IAAI,CAACC,YAAY,GAAG9B,IAAI,CAAC+B,MAAM,CAAA;EACjC,OAAC,MACI,IAAGT,OAAO,KAAK,OAAO,EAAE;EAC3B;EACA,QAAA,IAAIU,EAAE;EAAEC,UAAAA,MAAM,GAAG,IAAI,CAACP,KAAK,CAACO,MAAM,CAAA;EAClC,QAAA,IAAG,CAAC9B,IAAI,CAAC+B,KAAK,CAACD,MAAM,CAAC,EAAE;EACtB,UAAA,IAAGA,MAAM,EAAE;cACTD,EAAE,GAAGf,GAAG,CAACY,UAAU,CAAC,QAAQ,EAAEN,MAAM,CAAC,CAAA;EACvC,WAAA;YACA,IAAG,CAACS,EAAE,EAAE;cACNA,EAAE,GAAGf,GAAG,CAACY,UAAU,CAAC,OAAO,EAAEN,MAAM,CAAC,CAAA;EACtC,WAAA;YACA,IAAI,CAACK,KAAK,GAAGI,EAAE,CAAA;EACjB,SAAC,MACI;YACHA,EAAE,GAAG,IAAI,CAACJ,KAAK,GAAGX,GAAG,CAACY,UAAU,CAAC,QAAQ,EAAEN,MAAM,CAAC,IAC7CN,GAAG,CAACY,UAAU,CAAC,OAAO,EAAEN,MAAM,CAAC,CAAA;EACtC,SAAA;EACA,QAAA,IAAI,CAACY,YAAY,CAACH,EAAE,CAAC,CAAA;EACrB,QAAA,IAAI,CAACF,YAAY,GAAG9B,IAAI,CAACoC,KAAK,CAAA;EAChC,OAAA;EACA,MAAA,IAAI,CAACC,IAAI,CAAC,IAAI,CAAC,CAAA;EACf,MAAA,IAAG,IAAI,CAAClB,KAAK,CAACmB,MAAM,IAAI,IAAI,CAACnB,KAAK,CAACmB,MAAM,YAAY9B,IAAI,EAAE;EACzD,QAAA,IAAI,CAACW,KAAK,CAACmB,MAAM,CAACC,OAAO,EAAE,CAAA;EAC7B,OAAA;EACA,MAAA,IAAI,CAACpB,KAAK,CAACmB,MAAM,GAAG,IAAI,CAAA;EACxBjC,MAAAA,KAAK,CAACmC,UAAU,CAAC,IAAI,CAAC,CAAA;EACtBnC,MAAAA,KAAK,CAACoC,OAAO,CAAC,IAAI,CAAC,CAAA;EACrB,KAAA;EAAC,GAAA,EAAA;MAAA3B,GAAA,EAAA,SAAA;MAAAC,KAAA,EAED,SAAAwB,OAAAA,GAAU;EACRG,MAAAA,IAAA,CAAAC,eAAA,CAAAnC,IAAA,CAAAoC,SAAA,oBAAAC,IAAA,CAAA,IAAA,CAAA,CAAA;EACA,MAAA,IAAIC,CAAC,GAAGvC,QAAQ,CAACwC,OAAO,CAAC,IAAI,CAAC,CAAA;EAC9B,MAAA,IAAGD,CAAC,GAAG,CAAC,CAAC,EAAE;EACTvC,QAAAA,QAAQ,CAACyC,MAAM,CAACF,CAAC,EAAE,CAAC,CAAC,CAAA;EACvB,OAAA;EACF,KAAA;EAAC,GAAA,CAAA,CAAA,CAAA;EAAA,EAAA,OAAAtC,IAAA,CAAA;EAAA,CA9CgBP,CAAAA,yBAAK,CAACO,IAAI,CAiD7B,CAAA;EACA,IAAIyC,QAAQ,GAAGhD,yBAAK,CAACgD,QAAQ,CAAA;AAC7BhD,2BAAK,CAACgD,QAAQ,GAAG,UAAS3B,OAAO,EAAEI,KAAK,EAAEwB,QAAQ,EAAE;EAClD,EAAA,IAAG,CAAC,QAAQ,EAAE,KAAK,EAAE,OAAO,CAAC,CAACH,OAAO,CAACzB,OAAO,CAAC,GAAG,CAAC,CAAC,EAAE;MACnD,OAAO,IAAId,IAAI,CAACc,OAAO,EAAEI,KAAK,EAAEwB,QAAQ,CAAC,CAAA;EAC3C,GAAA;EACA,EAAA,OAAOD,QAAQ,CAAC3B,OAAO,EAAEI,KAAK,EAAEwB,QAAQ,CAAC,CAAA;EAC3C,CAAC,CAAA;EAED,IAAG,OAAOC,qBAAqB,KAAK,WAAW,EAAE;EAC/C/C,EAAAA,MAAM,CAAC+C,qBAAqB,GAAG,UAASC,EAAE,EAAE;MAC1C,IAAG,CAACA,EAAE,IAAI,CAAC7C,QAAQ,CAAC,CAAC,CAAC,EAAE;EACtB,MAAA,OAAA;EACF,KAAA;MACA,OAAOA,QAAQ,CAAC,CAAC,CAAC,CAACY,KAAK,CAACgC,qBAAqB,CAACC,EAAE,CAAC,CAAA;KACnD,CAAA;EAEDhD,EAAAA,MAAM,CAACiD,oBAAoB,GAAG,UAASC,EAAE,EAAE;EACzC,IAAA,IAAG,CAAC/C,QAAQ,CAAC,CAAC,CAAC,EAAE;EACf,MAAA,OAAA;EACF,KAAA;MACA,OAAOA,QAAQ,CAAC,CAAC,CAAC,CAACY,KAAK,CAACkC,oBAAoB,CAACC,EAAE,CAAC,CAAA;KAClD,CAAA;EACH,CAAA;EAEA,IAAMC,GAAG,GAAGnD,MAAM,CAACmD,GAAG,CAAA;EACtB,IAAMC,IAAI,GAAGpD,MAAM,CAACoD,IAAI,CAAA;EACxB,IAAMC,OAAO,GAAGrD,MAAM,CAACqD,OAAO,CAAA;EAC9B,IAAMC,MAAM,GAAGtD,MAAM,CAACsD,MAAM,CAAA;EAC5B,IAAMC,IAAI,GAAGvD,MAAM,CAACuD,IAAI,CAAA;EAExBvD,MAAM,CAACwD,UAAU,GAAG,UAASC,GAAG,EAAET,EAAE,EAAE;IACpC,IAAG,CAAC7C,QAAQ,CAACuD,MAAM,IAAI,CAACC,EAAE,CAACC,WAAW,EAAE;EACtC,IAAA,OAAA;EACF,GAAA;EACA,EAAA,IAAGC,KAAK,CAACC,OAAO,CAACL,GAAG,CAAC,EAAE;EACrB,IAAA,IAAG,CAACA,GAAG,CAACC,MAAM,EAAE;QACd,OAAOV,EAAE,IAAIA,EAAE,EAAE,CAAA;EACnB,KAAA;MACA,IAAIe,KAAK,GAAG,CAAC,CAAA;EACb,IAAA,IAAIC,GAAG,GAAGP,GAAG,CAACC,MAAM,CAAA;MACpB,IAAIO,IAAI,GAAG,EAAE,CAAA;EACbR,IAAAA,GAAG,CAACS,OAAO,CAAC,UAACC,IAAI,EAAEzB,CAAC,EAAK;EACvB1C,MAAAA,MAAM,CAACwD,UAAU,CAACW,IAAI,EAAE,UAASC,KAAK,EAAE;EACtCH,QAAAA,IAAI,CAACvB,CAAC,CAAC,GAAG0B,KAAK,CAAA;EACf,QAAA,IAAG,EAAEL,KAAK,KAAKC,GAAG,EAAE;EAClBhB,UAAAA,EAAE,IAAIA,EAAE,CAACiB,IAAI,CAAC,CAAA;EAChB,SAAA;EACF,OAAC,CAAC,CAAA;EACJ,KAAC,CAAC,CAAA;EACF,IAAA,OAAA;EACF,GAAC,MACI,IAAG,CAACR,GAAG,IAAI,CAAC1D,IAAI,CAACsE,QAAQ,CAACZ,GAAG,CAAC,EAAE;EACnCzD,IAAAA,MAAM,CAACsE,KAAK,CAAC,uBAAuB,GAAGb,GAAG,CAAC,CAAA;MAC3CT,EAAE,IAAIA,EAAE,CAAC;EACPuB,MAAAA,KAAK,EAAEjB,MAAM;EACbkB,MAAAA,OAAO,EAAE,KAAK;EACdf,MAAAA,GAAG,EAAHA,GAAAA;EACF,KAAC,CAAC,CAAA;EACF,IAAA,OAAA;EACF,GAAA;IACA,IAAIW,KAAK,GAAGjB,GAAG,CAACM,GAAG,CAAC,GAAGN,GAAG,CAACM,GAAG,CAAC,IAAI;EACjCc,IAAAA,KAAK,EAAEnB,IAAI;EACXqB,IAAAA,IAAI,EAAE,EAAA;KACP,CAAA;EACD,EAAA,IAAGL,KAAK,CAACG,KAAK,KAAKjB,MAAM,EAAE;EACzBN,IAAAA,EAAE,IAAIA,EAAE,CAACoB,KAAK,CAAC,CAAA;EACjB,GAAC,MACI,IAAGA,KAAK,CAACG,KAAK,KAAKlB,OAAO,EAAE;MAC/BL,EAAE,IAAIoB,KAAK,CAACK,IAAI,CAAC3D,IAAI,CAACkC,EAAE,CAAC,CAAA;EAC3B,GAAC,MACI;MACHoB,KAAK,CAACG,KAAK,GAAGlB,OAAO,CAAA;MACrBL,EAAE,IAAIoB,KAAK,CAACK,IAAI,CAAC3D,IAAI,CAACkC,EAAE,CAAC,CAAA;EACzB,IAAA,IAAI0B,GAAG,CAAA;MACP,IAAGf,EAAE,CAACC,WAAW,EAAE;EACjBc,MAAAA,GAAG,GAAGf,EAAE,CAACC,WAAW,EAAE,CAAA;EACxB,KAAC,MACI;QACHc,GAAG,GAAGvE,QAAQ,CAAC,CAAC,CAAC,CAACY,KAAK,CAAC6C,WAAW,EAAE,CAAA;EACvC,KAAA;MACAc,GAAG,CAACC,MAAM,GAAG,YAAW;QACtBP,KAAK,CAACG,KAAK,GAAGjB,MAAM,CAAA;QACpBc,KAAK,CAACI,OAAO,GAAG,IAAI,CAAA;EACpBJ,MAAAA,KAAK,CAACQ,KAAK,GAAGF,GAAG,CAACE,KAAK,CAAA;EACvBR,MAAAA,KAAK,CAACS,MAAM,GAAGH,GAAG,CAACG,MAAM,CAAA;QACzBT,KAAK,CAACU,MAAM,GAAGJ,GAAG,CAAA;QAClBN,KAAK,CAACX,GAAG,GAAGA,GAAG,CAAA;QACf,IAAIQ,IAAI,GAAGG,KAAK,CAACK,IAAI,CAAC7B,MAAM,CAAC,CAAC,CAAC,CAAA;EAC/BqB,MAAAA,IAAI,CAACC,OAAO,CAAC,UAAAlB,EAAE,EAAA;UAAA,OAAIA,EAAE,CAACoB,KAAK,CAAC,CAAA;SAAC,CAAA,CAAA;OAC9B,CAAA;EACDM,IAAAA,GAAG,CAACK,OAAO,GAAG,UAASC,CAAC,EAAE;QACxBZ,KAAK,CAACG,KAAK,GAAGjB,MAAM,CAAA;QACpBc,KAAK,CAACI,OAAO,GAAG,KAAK,CAAA;QACrBJ,KAAK,CAACX,GAAG,GAAGA,GAAG,CAAA;QACf,IAAIQ,IAAI,GAAGG,KAAK,CAACK,IAAI,CAAC7B,MAAM,CAAC,CAAC,CAAC,CAAA;EAC/BqB,MAAAA,IAAI,CAACC,OAAO,CAAC,UAAAlB,EAAE,EAAA;UAAA,OAAIA,EAAE,CAACoB,KAAK,CAAC,CAAA;SAAC,CAAA,CAAA;OAC9B,CAAA;MACDM,GAAG,CAACO,GAAG,GAAGxB,GAAG,CAAA;EACf,GAAA;EACF,CAAC,CAAA;EAEDzD,MAAM,CAACkF,KAAK,GAAG,UAASC,CAAC,EAAE;IACzB,OAAOA,CAAC,KAAKA,CAAC,CAACjE,OAAO,IAAIiE,CAAC,CAACvB,WAAW,CAAC,CAAA;EAC1C,CAAC,CAAA;EAED,IAAMjC,MAAM,GAAG,EAAE,CAAA;EAEjB,SAASyD,eAAeA,CAAC1E,GAAG,EAAEkE,KAAK,EAAEC,MAAM,EAAEQ,OAAO,EAAE9D,iBAAiB,EAAE;EACvE,EAAA,IAAI4D,CAAC,CAAA;IACL,IAAG,CAACzE,GAAG,EAAE;MACPyE,CAAC,GAAGxB,EAAE,CAAC2B,qBAAqB,GAAG3B,EAAE,CAAC2B,qBAAqB,CAAC;EAAEC,MAAAA,IAAI,EAAE,IAAI;EAAEX,MAAAA,KAAK,EAALA,KAAK;EAAEC,MAAAA,MAAM,EAANA,MAAAA;EAAO,KAAC,CAAC,GAAGlB,EAAE,CAAC6B,YAAY,EAAE,CAAA;EAC5G,GAAC,MACI,IAAG,CAAC7D,MAAM,CAACjB,GAAG,CAAC,EAAE;EACpByE,IAAAA,CAAC,GAAGxD,MAAM,CAACjB,GAAG,CAAC,GAAGiD,EAAE,CAAC2B,qBAAqB,GAAG3B,EAAE,CAAC2B,qBAAqB,CAAC;EAAEC,MAAAA,IAAI,EAAE,IAAI;EAAEX,MAAAA,KAAK,EAALA,KAAK;EAAEC,MAAAA,MAAM,EAANA,MAAAA;EAAO,KAAC,CAAC,GAAGlB,EAAE,CAAC6B,YAAY,EAAE,CAAA;EAC1H,GAAC,MACI;EACHL,IAAAA,CAAC,GAAGxD,MAAM,CAACjB,GAAG,CAAC,CAAA;EACjB,GAAA;EACA,EAAA,IAAG,CAACiD,EAAE,CAAC2B,qBAAqB,EAAE;MAC5BH,CAAC,CAACP,KAAK,GAAGA,KAAK,CAAA;MACfO,CAAC,CAACN,MAAM,GAAGA,MAAM,CAAA;EACnB,GAAA;IACA,IAAIY,GAAG,GAAGN,CAAC,CAAC1D,UAAU,CAAC,IAAI,EAAEF,iBAAiB,CAAC,CAAA;IAC/C,IAAG,CAACkE,GAAG,EAAE;EACPzF,IAAAA,MAAM,CAACsE,KAAK,CAAC,mDAAmD,CAAC,CAAA;EACnE,GAAA;IACA,OAAO;EACLoB,IAAAA,MAAM,EAAEP,CAAC;EACTM,IAAAA,GAAG,EAAHA,GAAG;EACHE,IAAAA,SAAS,EAAE,IAAI;MACfC,OAAO,EAAA,SAAAA,UAAG;QACRH,GAAG,CAACI,WAAW,GAAG,CAAC,CAAA;EACnBJ,MAAAA,GAAG,CAACK,YAAY,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAA;QAClCL,GAAG,CAACM,SAAS,CAAC,CAAC,EAAE,CAAC,EAAEnB,KAAK,EAAEC,MAAM,CAAC,CAAA;QAClC,IAAI,CAACc,SAAS,GAAG,KAAK,CAAA;EACxB,KAAA;KACD,CAAA;EACH,CAAA;EAEA3F,MAAM,CAACgG,kBAAkB,GAAG,UAAStF,GAAG,EAAE;EACxC,EAAA,OAAOA,GAAG,IAAIiB,MAAM,CAACsE,cAAc,CAACvF,GAAG,CAAC,CAAA;EAC1C,CAAC,CAAA;EAEDV,MAAM,CAACkG,kBAAkB,GAAG,UAAStB,KAAK,EAAEC,MAAM,EAAEnE,GAAG,EAAE2E,OAAO,EAAE9D,iBAAiB,EAAE;IACnF,OAAO6D,eAAe,CAAC1E,GAAG,EAAEkE,KAAK,EAAEC,MAAM,EAAEQ,OAAO,EAAE9D,iBAAiB,CAAC,CAAA;EACxE,CAAC,CAAA;EAEDvB,MAAM,CAACmG,QAAQ,GAAG,UAASC,UAAU,EAAE3C,GAAG,EAAET,EAAE,EAAE;EAC9C,EAAA,IAAG,CAACW,EAAE,CAAC0C,YAAY,EAAE;EACnB,IAAA,OAAA;EACF,GAAA;EACA,EAAA,IAAGtG,IAAI,CAACuG,UAAU,CAAC7C,GAAG,CAAC,EAAE;EACvBT,IAAAA,EAAE,GAAGS,GAAG,CAAA;EACRA,IAAAA,GAAG,GAAG2C,UAAU,CAAA;EAClB,GAAA;EACA,EAAA,IAAGvC,KAAK,CAACC,OAAO,CAACL,GAAG,CAAC,EAAE;EACrB,IAAA,IAAG,CAACA,GAAG,CAACC,MAAM,EAAE;EACd,MAAA,OAAOV,EAAE,EAAE,CAAA;EACb,KAAA;MACA,IAAIe,KAAK,GAAG,CAAC,CAAA;EACb,IAAA,IAAIC,GAAG,GAAGP,GAAG,CAACC,MAAM,CAAA;MACpB,IAAIO,IAAI,GAAG,EAAE,CAAA;EACbR,IAAAA,GAAG,CAACS,OAAO,CAAC,UAACC,IAAI,EAAEzB,CAAC,EAAK;EACvB1C,MAAAA,MAAM,CAACmG,QAAQ,CAAChC,IAAI,CAACiC,UAAU,EAAEjC,IAAI,CAACV,GAAG,EAAE,UAASW,KAAK,EAAE;EACzDH,QAAAA,IAAI,CAACvB,CAAC,CAAC,GAAG0B,KAAK,CAAA;EACf,QAAA,IAAG,EAAEL,KAAK,KAAKC,GAAG,EAAE;YAClBhB,EAAE,CAACiB,IAAI,CAAC,CAAA;EACV,SAAA;EACF,OAAC,CAAC,CAAA;EACJ,KAAC,CAAC,CAAA;EACF,IAAA,OAAA;EACF,GAAC,MACI,IAAG,CAACR,GAAG,IAAI,CAAC1D,IAAI,CAACsE,QAAQ,CAACZ,GAAG,CAAC,EAAE;EACnCzD,IAAAA,MAAM,CAACsE,KAAK,CAAC,qBAAqB,GAAGb,GAAG,CAAC,CAAA;MACzCT,EAAE,IAAIA,EAAE,CAAC;EACPuB,MAAAA,KAAK,EAAEjB,MAAM;EACbkB,MAAAA,OAAO,EAAE,KAAK;EACdf,MAAAA,GAAG,EAAHA,GAAAA;EACF,KAAC,CAAC,CAAA;EACF,IAAA,OAAA;EACF,GAAA;IACA,IAAG,CAAC2C,UAAU,EAAE;EACdA,IAAAA,UAAU,GAAG3C,GAAG,CAAA;EAClB,GAAA;IACA,IAAIW,KAAK,GAAGb,IAAI,CAACE,GAAG,CAAC,GAAGF,IAAI,CAACE,GAAG,CAAC,IAAI;EACnCc,IAAAA,KAAK,EAAEnB,IAAI;EACXqB,IAAAA,IAAI,EAAE,EAAA;KACP,CAAA;EACD,EAAA,IAAGL,KAAK,CAACG,KAAK,KAAKjB,MAAM,EAAE;EACzBN,IAAAA,EAAE,IAAIA,EAAE,CAACoB,KAAK,CAAC,CAAA;EACjB,GAAC,MACI,IAAGA,KAAK,CAACG,KAAK,KAAKlB,OAAO,EAAE;MAC/BL,EAAE,IAAIoB,KAAK,CAACK,IAAI,CAAC3D,IAAI,CAACkC,EAAE,CAAC,CAAA;EAC3B,GAAC,MACI;EAAA,IAAA,IAcMwB,OAAO,GAAhB,SAASA,OAAOA,GAAG;QACjBJ,KAAK,CAACG,KAAK,GAAGjB,MAAM,CAAA;QACpBc,KAAK,CAACI,OAAO,GAAG,IAAI,CAAA;QACpBJ,KAAK,CAACX,GAAG,GAAGA,GAAG,CAAA;QACf,IAAIQ,IAAI,GAAGG,KAAK,CAACK,IAAI,CAAC7B,MAAM,CAAC,CAAC,CAAC,CAAA;EAC/BqB,MAAAA,IAAI,CAACC,OAAO,CAAC,UAAAlB,EAAE,EAAA;EAAA,QAAA,OAAIA,EAAE,CAACoB,KAAK,EAAEmC,EAAE,CAAC,CAAA;SAAC,CAAA,CAAA;OAClC,CAAA;EAAA,IAAA,IACQjC,KAAK,GAAd,SAASA,KAAKA,GAAG;QACfF,KAAK,CAACG,KAAK,GAAGjB,MAAM,CAAA;QACpBc,KAAK,CAACI,OAAO,GAAG,KAAK,CAAA;QACrBJ,KAAK,CAACX,GAAG,GAAGA,GAAG,CAAA;QACf,IAAIQ,IAAI,GAAGG,KAAK,CAACK,IAAI,CAAC7B,MAAM,CAAC,CAAC,CAAC,CAAA;EAC/BqB,MAAAA,IAAI,CAACC,OAAO,CAAC,UAAAlB,EAAE,EAAA;UAAA,OAAIA,EAAE,CAACoB,KAAK,CAAC,CAAA;SAAC,CAAA,CAAA;OAC9B,CAAA;MA1BDA,KAAK,CAACG,KAAK,GAAGlB,OAAO,CAAA;MACrBL,EAAE,IAAIoB,KAAK,CAACK,IAAI,CAAC3D,IAAI,CAACkC,EAAE,CAAC,CAAA;MACzB,IAAGS,GAAG,YAAY+C,WAAW,EAAE;QAC7BhC,OAAO,CAACf,GAAG,CAAC,CAAA;EACd,KAAC,MACI;QACHE,EAAE,CAAC0C,YAAY,CAAC;EACdI,QAAAA,MAAM,EAAEL,UAAU;EAClBtB,QAAAA,MAAM,EAAA4B,QAAAA,CAAAA,MAAA,CAAUjD,GAAG,EAAI,KAAA,CAAA;EACvBe,QAAAA,OAAO,EAAPA,OAAO;EACPmC,QAAAA,IAAI,EAAErC,KAAAA;EACR,OAAC,CAAC,CAAA;EACJ,KAAA;EAeF,GAAA;EACF,CAAC,CAAA;AAEDzE,2BAAK,CAAC+G,SAAS,GAAGC,OAAO;;;;;;;;"}